define(["jquery","jquery.cookie","avalon","jquery.blockUI"],function($){function isEmpty(a,b){return!(!a||null==a||""==a)}function getBrowserInfo(){var a=navigator.userAgent.toLowerCase(),b=/(msie|trident) [\d.]+;/gi,c=/firefox\/[\d.]+/gi,d=/chrome\/[\d.]+/gi,e=/safari\/[\d.]+/gi;return a.indexOf("msie")>0?a.match(b):a.indexOf("firefox")>0?a.match(c):a.indexOf("chrome")>0?a.match(d):a.indexOf("safari")>0&&a.indexOf("chrome")<0?a.match(e):"unknown"}function _toThousands(a){for(var a=(a||0).toString(),b="";a.length>3;)b=","+a.slice(-3)+b,a=a.slice(0,a.length-3);return a&&(b=a+b),b}function _ajax(a){$.ajax({type:a.type||"post",url:defaults.baseUrl+a.url+"?random="+Math.random(),dataType:"json",async:void 0==a.async||a.async,data:a.data||{},timeout:3e5,success:function(b){b.error_code||""==b.error_code?a.failure?a.failure(b):_callException(b):_callSuccess(a.callback,b)},error:function(b,c,d){4!=b.readyState||"200"!=b.status&&"OK"!=c?(defaults.alertNode.find("p").text("调用数据失败，请稍后再试。"),_showAlert({message:defaults.alertNode})):_callError(a.failure,b.responseText)}})}function _callSuccess(a,b){a&&a(b.data)}function _callException(a){defaults.alertNode.find("p").text(a.error_info),"291"==a.error_no?($.cookie("_u_",window.location,{path:"/",expires:10}),$.cookie("_a_","",{path:"/",expires:-1}),$.cookie("_n_","",{path:"/",expires:-1}),$.cookie("_t_","",{path:"/",expires:-1}),window.location.href="/login/login.html"):_showAlert({message:defaults.alertNode})}function _callError(a,b){a?a(b):(defaults.alertNode.find("p").html(b),_showAlert({message:defaults.alertNode}))}function _showAlert(a){var b=a.message,c=$.extend({},a,{message:b});if("object"===$.type(b)){var d=_position(a);c.css=c.css||{},$.extend(c.css,d)}_show(c)}function _position(a){var b=a.message,c=a.fixed||!0,d=b.width(),e=b.height();if(c){var f=a.width||280,g=a.height||140;d=d<f?f:d,e=e<g?g:e}var h=$(window).width(),i=(h-d)/2,j=$(window).height(),k=(j-e)/2;k=k<0?30:k;var l=Math.floor(k/j*100);return l=l<0?1:l,{left:i+"px",width:d+"px",height:e+"px",top:l+"%","z-index":9999999}}function _show(a){var b={message:a.message,overlayCSS:{opacity:.15,cursor:"default",zIndex:9999998},css:$.extend({position:"fixed",border:"0px",backgroundColor:"none",cursor:"auto",textAlign:"left"},a.css||{}),onBlock:a.onBlock||function(){}};void 0!=a.onOverlay&&1!=a.onOverlay||$.extend(b,{onOverlayClick:function(){_close(a.onUnblock)}}),$.blockUI(b),a.message.find(".close-btn").click(function(){_close(a.onUnblock)})}function _close(a){$.unblockUI({fadeOut:700,onUnblock:a||function(){}})}function _createIframe(a){var b=document.createElement("iframe");return b.setAttribute("frameborder","0",0),b.width="100%",b.scrolling="no",b.height="100%",b.attachEvent?b.attachEvent("onload",function(){_adaptiveHeight(a,b)}):b.onload=function(){_adaptiveHeight(a,b)},b}function _adaptiveHeight(a,b){a.css("height",_getIframeBodyHeight(b))}function _getIframeBodyHeight(a){return a.document?$(a.document.body).height():a.contentDocument?$(a.contentDocument.body).height():void 0}var appkey="",app_key=function(){return $.ajax({type:"get",url:"/common/appkey.json?random="+Math.random(),dataType:"json",async:!1,data:{},timeout:5e3,success:function(a){},error:function(XMLHttpRequest,textStatus,errorThrown){var result=eval("("+XMLHttpRequest.responseText+")");appkey=result.appkey}}),appkey},_hmt=_hmt||[];!function(){var a=document.createElement("script");a.src="https://hm.baidu.com/hm.js?49c75c87715bf9dcae34bb8f5e067024";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}();var defaults={img_url:"/api/",page_type:"open",cms_url:"http://10.139.103.50",alertNode:$('<div class="con-pop"><div class="inner"><div class="title">提示<a class="close-btn"></a></div> <div class="details"><p></p></div></div></div>'),confirmNode:$('<div class="popUp-layer" style="display:block; "><span class="close" title="关闭" id="popClose">关闭</span><div class="popUp-layer-wrap"><div class="popUp-layer-content popUp-layer-contentticket"><p id="popContent"></p><div class="sub-btn"><a class="ui-btn btn-blue btn-radius" id="btn1"></a><a class="ui-btn btn-white btn-radius" id="btn2"></a></div></div></div></div>'),confirmNode_shop:$('<div class="popUp-layer" style="display:block;"><span class="close" title="关闭" id="popClose">关闭</span><div class="popUp-layer-wrap"><div class="popUp-layer-content"><p id="popContent"></p><div class="sub-btn"><a class="ui-btn btn-white btn-radius" id="btn1"></a><a class="ui-btn btn-red btn-radius" id="btn2"></a></div></div></div></div>'),baseUrl:"/cloud/open/",hash:{"vip.qq.com":"http://mail.qq.com","qq.com":"http://mail.qq.com","gmail.com":"http://mail.google.com","sina.com":"http://mail.sina.com.cn","163.com":"http://mail.163.com","126.com":"http://mail.126.com","yeah.net":"http://www.yeah.net/","sohu.com":"http://mail.sohu.com/","tom.com":"http://mail.tom.com/","sogou.com":"http://mail.sogou.com/","139.com":"http://mail.10086.cn/","hotmail.com":"http://www.hotmail.com","live.com":"http://login.live.com/","live.cn":"http://login.live.cn/","live.com.cn":"http://login.live.com.cn","189.com":"http://webmail16.189.cn/webmail/","yahoo.com.cn":"http://mail.cn.yahoo.com/","yahoo.cn":"http://mail.cn.yahoo.com/","eyou.com":"http://www.eyou.com/","21cn.com":"http://mail.21cn.com/","188.com":"http://www.188.com/","foxmail.com":"http://www.foxmail.com","hundsun.com":"http://mail.hundsun.com/"},array:["hundsun.com","qq.com","sina.com","163.com","sohu.com","gmail.com","hotmail.com","yahoo.cn","foxmail.com"]};return{key:"",detectOS:function(){var a=navigator.userAgent,b="Win32"==navigator.platform||"Windows"==navigator.platform,c="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;if(c)return"Mac";var d="X11"==navigator.platform&&!b&&!c;if(d)return"Unix";var e=String(navigator.platform).indexOf("Linux")>-1;if(e)return"Linux";if(b){var f=a.indexOf("Windows NT 5.0")>-1||a.indexOf("Windows 2000")>-1;if(f)return"Win2000";var g=a.indexOf("Windows NT 5.1")>-1||a.indexOf("Windows XP")>-1;if(g)return"WinXP";var h=a.indexOf("Windows NT 5.2")>-1||a.indexOf("Windows 2003")>-1;if(h)return"Win2003";var i=a.indexOf("Windows NT 6.0")>-1||a.indexOf("Windows Vista")>-1;if(i)return"WinVista";var j=a.indexOf("Windows NT 6.1")>-1||a.indexOf("Windows 7")>-1;if(j)return"Win7"}return"other"},detectmob:function(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))},getImageUrl:function(){return defaults.img_url},getImageUrlApi:function(){return defaults.img_url_api},getPage_type:function(){return defaults.page_type},getScreen:function(){return"高："+window.screen.height+"px;宽："+window.screen.width+"px"},getBrowser:function(){return getBrowserInfo().toString()},obj2string:function(a){var b=[];if("string"==typeof a)return'"'+a.replace(/([\'\"\\])/g,"\\$1").replace(/(\n)/g,"\\n").replace(/(\r)/g,"\\r").replace(/(\t)/g,"\\t")+'"';if("object"==typeof a){if(a.sort){for(var c=0;c<a.length;c++)b.push(obj2string(a[c]));b="["+b.join()+"]"}else{for(var c in a)b.push(c+":"+this.obj2string(a[c]));document.all&&!/^\n?function\s*toString\(\)\s*\{\n?\s*\[native code\]\n?\s*\}\n?\s*$/.test(a.toString)&&b.push("toString:"+a.toString.toString()),b="{"+b.join()+"}"}return b}return a.toString()},isLogin:function(){var a="";return _ajax({url:"user/islogin.json",async:!1,callback:function(b){if(0!=b){if(b.nikeName){if(a=$.trim(b.nikeName),/^1[3|4|5|7|8]\d{9}$/.test(a)||/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/.test(a)){var c=a.substring(0,3),d=a.substring(a.length-4,a.length);a=c+"****"+d}}else{a=b.hsid;var c=a.substring(0,3),d=a.substring(a.length-4,a.length);a=c+"****"+d}"1"==b.userActive&&_ajax({url:"user/updatePwdSuccess.json",async:!1,callback:function(a){tips("您的账号已锁定，请联系客服开通！"),setTimeout(function(){window.location.href=a},2e3)}})}}}),a},options:defaults,ajax:function(a){_ajax(a)},alert:function(a){_showAlert(a)},getRSA:function(){if(RSAUtils){var a=this;a.ajax({url:"user/getModulusExponent.json",type:"GET",callback:function(b){a.key=RSAUtils.getKeyPair(b.exponent,"",b.modulus)}})}},encoding:function(a){return RSAUtils&&""!=this.key?RSAUtils.encryptedString(this.key,a):a},getUrlParam:function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)"),c=window.location.search.substr(1).match(b);return null!=c?c[2]:""},getUrlParam2:function(a){var b="",c=window.location.hash;if(c.indexOf("?")>-1){var d=c.substr(c.indexOf("?")+1+a.length+1);b=d}return b},getCms:function(){return defaults.cms_url},showSuccess:function(a){$(a).parent("div").append('<div class="sl-error"><span class="ui-icon ui-icon-right"></span></div>')},showError:function(a,b,c){$(a).parent("div").find(".sl-error-remote").remove(),$(a).parent("div").find(".sl-error").remove();var d=$(a).parent("div").find(".sl-error").length;c?($(a).parent("div").append('<div class="sl-error"><span class="ui-icon ui-icon-error"></span><p>'+c+"</p>"),$(a).addClass("error")):b&&!d>0&&$(a).parent("div").append('<div class="sl-error"><span class="ui-icon ui-icon-error"></span><p>'+b.getMessage()+"</p>")},alignCenter:function(a){var b=!window.XMLHttpRequest,c={};if(b){c.top=document.documentElement.scrollTop,c.left=document.documentElement.scrollLeft;var d=document.documentElement.clientWidth,e=document.documentElement.clientHeight,f=document.getElementById(a);f.style.top=c.top+(e-f.offsetHeight)/2+"px",f.style.left=c.left+(d-f.offsetWidth)/2+"px"}else{var f=document.getElementById(a),g=($(window).height()-$(f).height())/2,h=($(window).width()-$(f).width())/2,i=$(document).scrollTop(),j=$(document).scrollLeft();f.style.top=g+i+"px",f.style.left=h+j+"px"}},removeError:function(a){$(a).parent("div").find(".sl-error").remove(),$(a).removeClass("error")},confirmNode_shop:function(a){var b=this,c=a.btn,d=a.message,e=defaults.confirmNode_shop;e.find("#popClose").unbind("click").click(function(){b.closeAlert()}),e.find("#popContent").html(d),e.find("#btn1").html(c[0].tip).unbind("click").click(function(){c[0].event(),b.closeAlert()}),e.find("#btn2").html(c[1].tip).unbind("click").click(function(){c[1].event(),b.closeAlert()}),_showAlert({message:e,onOverlay:!1,css:{border:"0px",backgroundColor:"none",textAlign:"center"}})},confirm:function(a){var b=this,c=a.btn,d=a.message,e=defaults.confirmNode;e.find("#popClose").unbind("click").click(function(){b.closeAlert()}),e.find("#popContent").html(d),e.find("#btn1").html(c[0].tip).unbind("click").click(function(){c[0].event(),b.closeAlert()}),e.find("#btn2").html(c[1].tip).unbind("click").click(function(){c[1].event(),b.closeAlert()}),_showAlert({message:e,onOverlay:!1,css:{border:"0px",backgroundColor:"none",textAlign:"center"}})},confirm_c:function(a){var b=this,c=a.btn,d=a.message,e=defaults.confirmNode;e.find("#popClose").unbind("click").click(function(){b.closeAlert(a.onUnblock)}),e.find("#popContent").html(d),e.find("#btn1").html(c[0].tip).unbind("click").click(function(){c[0].event(),b.closeAlert()}),e.find("#btn2").html(c[1].tip).unbind("click").click(function(){c[1].event(),b.closeAlert()}),_showAlert({message:e,onOverlay:!1,css:{border:"0px",backgroundColor:"none",textAlign:"center"}})},loading:function(){_showAlert({message:$('<div class="loading"><img src="/image/loading.gif"/></div>'),onOverlay:!1,css:{border:"0px",backgroundColor:"none",textAlign:"center"}})},alertIframe:function(a){var b=a.width||640,c=a.height||100,d=a.top||20,e=$(window).width(),f=(e-b)/2;_show.apply(this,[{message:"加载中...",css:{left:f+"px",width:b+"px",height:c+"px",top:d+"%"},onBlock:function(){var b=$(this),c=_createIframe(b);c.src=a.url,b.html(c),a.onBlock&&a.onBlock(b)}}])},closeAlert:function(a){_close(a)},checkStrong:function(a){a=a.replace(/\s+/,"");var b=0;return a.length<6?b:(/\d/.test(a)&&b++,/[a-z]/.test(a)&&b++,/[A-Z]/.test(a)&&b++,/\W/.test(a)&&b++,b>3?3:b)},getHash:function(a){return defaults.hash},getArray:function(a){return defaults.array},checkEmail:function(a){var b=a.split("@")[1];return defaults.hash[b]},subName:function(a){if(a.length>9){var b=a.substring(0,9);return b}return a},showX:function(a){var b=a.substring(0,3),c=a.substring(a.length-4,a.length);return b+"******"+c},getPrice:function(a,b){var c=(parseFloat(a)*b).toString();return c.indexOf(".")==-1&&(c+=".00"),c},totalPrice:function(a){var b=_toThousands(a);return b.toString().indexOf(".")==-1&&(b+=".00"),b},toThousands:function(a){var a=(a||0).toString(),b="";if(a.indexOf(".")!=-1){var c=a.split(".")[0],d=a.split(".")[1];(d.length<1||1==d.length)&&(d+=0)}else var c=a,d="00";for(;c.length>3;)b=","+c.slice(-3)+b,c=c.slice(0,c.length-3);return c&&(b=c+b),b+"."+d},initTop:function(){document.documentElement.scrollTop=0,document.body.scrollTop=0},getUserId:function(){var a="";return _ajax({url:"user/islogin.json",async:!1,callback:function(b){a=b.user_id?b.user_id:"",""!=a&&null!=a||(window.location.href.indexOf("login")==-1?$.cookie("_u_",window.location,{path:"/",expires:10}):$.cookie("_u_","",{path:"/",expires:-1}),window.location.href="/html/login_api/login.html")}}),a},alertNodePop:function(a){defaults.alertNode.find("p").text(a),_showAlert({message:defaults.alertNode})},tips:function(a,b){b=void 0==b?1e3:b,$.blockUI({message:'<div class="con-pop" style="z-index:99999"><div class="inner"><div class="details"><p style="text-align: center">'+a+"</p></div></div></div>",timeout:b,overlayCSS:{opacity:.15,cursor:"default"},css:{left:"43%",position:"fixed",border:"0px",backgroundColor:"none",cursor:"auto",textAlign:"left"}})},check_imgcode:function(a,b){var c=!0,d=/^[a-z0-9]{4}$/i.test(b);return $(a).parent().find(".sl-error").remove(),isEmpty(b)?d?_ajax({url:"imageCode/validateImageCode.json",data:{imageCode:b},async:!1,callback:function(b){b?($(a).parent().find(".sl-error").remove(),c=!0):($(a).parent().append('<div class="sl-error"><span class="ui-icon ui-icon-error"></span><p>验证码错误</p></div>'),$(a).parent().parent().find(".verifyImg").attr("src","/cloud/open/imageCode/getImageCode.json?time="+(new Date).getTime()),c=!1)}}):($(a).parent().append('<div class="sl-error"><span class="ui-icon ui-icon-error"></span><p>验证码格式不正确，请重新输入</p></div>'),c=!1):($(a).parent().append('<div class="sl-error"><span class="ui-icon ui-icon-error"></span>请输入验证码</div>'),c=!1),c},accSub:function(a,b){var c,d,e,f;try{c=a.toString().split(".")[1].length}catch(a){c=0}try{d=b.toString().split(".")[1].length}catch(a){d=0}return e=Math.pow(10,Math.max(c,d)),f=c>=d?c:d,((a*e-b*e)/e).toFixed(f)},isEmpty:function(a,b){return!(!a||null==a||""==a)}}});